{% extends "base.html" %}
{%block body%}

{% set generos_unicos = [] %}
{% for p in peliculas %}
    {% if p.genero not in generos_unicos %}
        {% set _ = generos_unicos.append(p.genero) %}
    {% endif %}
{% endfor %}


<body class="text-white bg-gradient-to-b from-gray-900 to-black text-gray-200 font-sans">



  <section class="secciones mt-32 min-h-screen flex flex-col gap-4 justify-items-center gap-y-12">
  <h2 class="titulo text-3xl px-6 font-bold translate-x-[3%] mb-8">
    Pel√≠culas En cartelera
  </h2>
    <div class="w-64 mb-8">
    <label class="block text-gray-300 mb-2 font-semibold ml-10">Filtrar por g√©nero</label>

    <select id="filtroGenero" 
            class="w-full bg-[rgb(44,44,44)] text-gray-200 border border-[rgb(112,0,0)] rounded-lg px-3 py-2 ml-10">
        <option value="todos">Todos los g√©neros</option>

        {% for genero in generos_unicos %}
            <option value="{{ genero }}">{{ genero }}</option>
        {% endfor %}
    </select>
    </div>

  
  <div class="cards-peliculas  grid grid-cols-4 justify-items-center gap-y-30 max-w-7xl mx-auto px-4 py-10 gap-x-5">
    {% for p in peliculas %}
    <div class="card-pelicula {% if loop.index > 8 %} hidden extra-pelicula {% endif %}" data-genero="{{ p.genero }}"
    onclick='mostrarPelicula( 
        {{ p.titulo|tojson }},
        {{ p.duracion|tojson}},
        {{ p.sinopsis|tojson}},
        {{ p.director|tojson}},
        {{ p.genero|tojson}},
        {{ p.id_pelicula|tojson}},
        {{ p.imagen_url|tojson}}
        
    )'>
      <img 
        src="{{ url_for('static', filename='img/gladiator.jpg') }}" 
        alt="{{ p.titulo }}" 
        class="img-card w-60 h-full object-cover rounded-t-2xl shadow-lg">
      <div class=" text-white w-60 h-25 rounded-b-2xl shadow-md bg-[rgb(44,44,44)] text-white rounded-b-2xl px-3 py-3">
        <h3 class="text-lg font-semibold">{{ p.titulo }}</h3>
            <div class="flex flex-col gap-1 mt-1 text-gray-300 text-sm">
            <p class="truncate">‚è± {{ p['duracion'] }}</p>
            <p class="truncate">üé¨ {{ p['genero'] }}</p>
</div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
<div class="text-center mt-20">
    <button id="btnMostrarMas" class="px-6 py-3 bg-red-600 hover:bg-[rgb(44,44,44)] text-white text-lg rounded-xl font-semibold">
        Mostrar m√°s
    </button>
</div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
async function mostrarPelicula(titulo, duracion, sinopsis, director, genero, id_pelicula, imagen_url) {

 
    const resp = await fetch(`/api/funciones/${id_pelicula}`);
    const funciones = await resp.json();

   
    let funcionesHTML = "";
    funciones.forEach(f => {
        funcionesHTML += `
            <div class="flex justify-between bg-gray-700 px-4 py-2 rounded-lg cursor-pointer hover:bg-red-700 transition"
                 onclick="location.href='/butacas?pelicula=${id_pelicula}&funcion=${f.id_funcion}'">
                <span>${f.fecha_hora}</span>
                <span>$${f.precio_base}</span>
            </div>
        `;
    });

   let opciones = `<option value="">Eleg√≠ un horario</option>`;
    funciones.forEach(f => {
        opciones += `
            <option value="${f.id_funcion}">
                ${f.fecha_hora} - $${f.precio_base}
            </option>`;
    });
    
    Swal.fire({
        width: '80%',
        background: '#111',
        color: '#fff',
        showConfirmButton: false,
        html: `
        <div class="flex flex-col md:flex-row text-left">

            <div class="md:w-1/3">
                <img src="static/${imagen_url}" class="rounded-lg shadow-lg w-full mb-2">

                <div class="mt-2">
                    <span class="px-3 py-1 bg-gray-700 rounded-full text-sm inline-block">
                        ${genero}
                    </span>
                </div>
            </div>

            <div class="md:w-2/3 md:pl-6">
                <h1 class="text-3xl font-bold mb-2 text-red-700">${titulo}</h1>

                <p class="text-gray-300 mb-4 leading-relaxed">${sinopsis}</p>

                <p class="text-sm text-gray-400 mb-2"><b>Director:</b> ${director}</p>
                <p class="text-sm text-gray-400 mb-4"><b>Duraci√≥n:</b> ${duracion} min</p>

                <h2 class="text-xl font-semibold text-white mb-2">Horarios disponibles</h2>

                <div class="flex flex-col gap-3 mb-6">
                    ${funcionesHTML}
                </div>

            </div>

        </div>
        `
    });
}
</script>


<script>
document.getElementById("btnMostrarMas").addEventListener("click", function () {
    document.querySelectorAll(".extra-pelicula").forEach(card => {
        card.classList.remove("hidden");
    });

    this.style.display = "none"; 
});
</script>

<script>
document.getElementById("filtroGenero").addEventListener("change", function () {
    const generoSeleccionado = this.value.toLowerCase();
    const peliculas = document.querySelectorAll(".card-pelicula");

    peliculas.forEach(card => {
        const generoCard = card.dataset.genero.toLowerCase();

        if (generoSeleccionado === "todos" || generoCard === generoSeleccionado) {
            card.style.display = "block";
        } else {
            card.style.display = "none";
        }
    });
});
</script>

</body>




{% endblock %}