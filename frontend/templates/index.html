{% extends "base.html" %} {% block body %}
<div class="relative w-full">
  <div id="carousel" class="relative w-full h-[800px] overflow-hidden rounded-lg">
    <div class="slide absolute w-full h-full opacity-0 transition-opacity duration-700">
      <div class="relative w-full h-[800px]">
        <img
          src="https://beam-images.warnermediacdn.com/BEAM_LWM_DELIVERABLES/87dba8e5-aade-4d6b-af2b-917471ba6b43/5c116b9b-27eb-48f8-97ab-1ec044fd9a28?host=wbd-images.prod-vod.h264.io&partner=beamcom"
          class="absolute w-full h-full object-cover" />
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
        <div class="absolute top-[60%] left-[10%] w-[80%] text-left text-white">
          <h1 class="text-7xl font-bold drop-shadow-md">Rapido y furiosos</h1>
          <p class="mt-4 w-1/2 text-lg font-semibold">
            Es una pel√≠cula de acci√≥n sobre un polic√≠a encubierto, Brian
            O'Conner (Paul Walker), que se infiltra en el mundo de las carreras
            callejeras para investigar a una banda de ladrones de camiones
            liderada por Dominic Toretto (Vin Diesel). Durante su misi√≥n, Brian
            establece una amistad con Toretto y se debate entre su lealtad a la
            polic√≠a y el mundo que ha llegado a conocer. .
          </p>
          <a href="{{ url_for('cartelera') }}"
            class="mt-8 px-6 py-3 bg-red-700 hover:bg-red-800 font-bold rounded-lg inline-block">Comprar ticket</a>
        </div>
      </div>
    </div>

    <div class="slide absolute w-full h-full opacity-0 transition-opacity duration-700">
      <div class="relative w-full h-[800px]">
        <img src="https://4kwallpapers.com/images/walls/thumbs_3t/20138.jpg"
          class="absolute w-full h-full object-cover" />
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
        <div class="absolute top-[60%] left-[10%] w-[80%] text-left text-white">
          <h1 class="text-7xl font-bold">Moana 2</h1>
          <p class="mt-4 w-1/2 text-lg font-semibold">
            La aventura musical animada donde Moana debe emprender un nuevo
            viaje por los mares de Ocean√≠a tras recibir una llamada inesperada
            de sus ancestros. Su misi√≥n es encontrar una isla m√≠stica perdida
            para salvar a su pueblo de una maldici√≥n.
          </p>
          <a href="{{ url_for('cartelera') }}"
            class="mt-8 px-6 py-3 bg-red-700 hover:bg-red-800 font-bold rounded-lg inline-block">Comprar ticket</a>
        </div>
      </div>
    </div>

    <div class="slide absolute w-full h-full opacity-0 transition-opacity duration-700">
      <div class="relative w-full h-[800px]">
        <img src="https://4kwallpapers.com/images/walls/thumbs_3t/18118.jpg"
          class="absolute w-full h-full object-cover" />
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
        <div class="absolute top-[60%] left-[10%] w-[80%] text-left text-white">
          <h1 class="text-7xl font-bold">Gladiator</h1>
          <p class="mt-4 w-1/2 text-lg font-semibold">
            dirigida por Ridley Scott, que narra la historia de M√°ximo, un
            general romano que se convierte en esclavo y gladiador tras la
            muerte de su amigo, el emperador Marco Aurelio, a manos de su propio
            hijo, C√≥modo.
          </p>
          <a href="{{ url_for('cartelera') }}"
            class="mt-8 px-6 py-3 bg-red-700 hover:bg-red-800 font-bold rounded-lg inline-block">Comprar ticket</a>
        </div>
      </div>
    </div>
  </div>

  <button id="prev"
    class="absolute top-1/2 left-4 z-30 w-10 h-10 bg-black/40 hover:bg-black/70 text-white rounded-full">
    ‚ùÆ
  </button>
  <button id="next"
    class="absolute top-1/2 right-4 z-30 w-10 h-10 bg-black/40 hover:bg-black/70 text-white rounded-full">
    ‚ùØ
  </button>
</div>

<div class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-3xl font-bold mb-6">  Disponible Hoy</h2>

  <div class="swiper2 mySwiper2">
    <div class="swiper-wrapper">
      {% for p in peliculas %}
      <div
        class="swiper-slide flex justify-center"
      >
      <div
        class="card-pelicula pelicula-cartelera cursor-pointer {% if loop.index > 8 %} hidden extra-pelicula {% endif %}"
        data-titulo="{{ p.titulo }}"
        data-duracion="{{ p.duracion }}"
        data-sinopsis="{{ p.sinopsis }}"
        data-director="{{ p.director }}"
        data-genero="{{ p.genero }}"
        data-id="{{ p.id_pelicula }}"
        data-img="{{ url_for('static', filename=p.imagen_url) }}"
      >
         <img 
        src="{{ url_for('static', filename=p.imagen_url) }}"
        alt="{{ p.titulo }}" 
        class="img-card w-60 h-96 object-cover rounded-t-2xl shadow-lg">
      <div class=" text-white w-full h-25 rounded-b-2xl shadow-md bg-[rgb(44,44,44)] text-white rounded-b-2xl px-3 py-3">
        <h3 class="text-lg font-semibold">{{ p.titulo }}</h3>
            <div class="flex flex-col gap-1 mt-1 text-gray-300 text-sm">
            <p class="truncate">‚è± {{ p['duracion'] }}</p>
            <p class="truncate">üé¨ {{ p['genero'] }}</p>
            </div>
      </div>
    </div>
      </div>
      {% endfor %}
    </div>
</div>
  

    <div class="max-w-7xl mx-auto px-4 py-10">
      <h2 class="text-3xl font-bold mb-6">Pr√≥ximamente</h2>
    </div>
      <div class="swiper2 mySwiper2">
        <div class="swiper-wrapper">
          {% for p in proximamente %}
          <div
            class="swiper-slide flex justify-center"
            
          >
          <div class="bg-[#1a1a1a] rounded-2xl overflow-hidden shadow-lg w-64">
          <div class="w-full h-96 overflow-hidden">
            <img src="/static/{{ p['imagen_url'] if p['imagen_url'] else 'img/DefaultM.jpeg' }}"
              class="w-full h-full object-cover" />
          </div>
          <div class="px-3 py-3">
            <h3 class="font-bold text-lg truncate text-white">
              {{ p['titulo'] }}
            </h3>

            <div class="flex flex-col gap-1 mt-1 text-gray-300 text-sm">
              <p class="truncate">‚è± {{ p['duracion'] }}</p>
              <p class="truncate">üé¨ {{ p['genero'] }}</p>
            </div>
          </div>
        </div>
          </div>
          {% endfor %}
        </div>

  <script>
    const swiper2 = new Swiper(".mySwiper2", {
      slidesPerView: 5,
      spaceBetween: 20,
      loop: true,
      autoplay: {
        delay: 2000,
        disableOnInteraction: false,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      breakpoints: {
        0: { slidesPerView: 3 },
        640: { slidesPerView: 3 },
        1024: { slidesPerView: 5 },
        1280: { slidesPerView: 5 },
      },
    });
  </script>

       
        <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
          crossorigin="anonymous"
        ></script>

        <script src="{{ url_for('static', filename='js/carousel.js') }}"></script>

<div class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-3xl font-bold mb-6">Nosotros</h2>

  <div class="swiper mySwiper">
    <div class="swiper-wrapper">
      {% for img in imagenes %}
      <div class="swiper-slide flex justify-center">
        <div class="rounded-xl overflow-hidden shadow-lg aspect-square w-full max-w-xl">
          <img src="{{ url_for('static', filename=img) }}" class="w-full h-full object-cover" />
        </div>
      </div>
      {% endfor %}

    </div>
    <div class="swiper-button-next text-white"></div>
    <div class="swiper-button-prev text-white"></div>

  </div>
  <div class="mt-6 font-semibold">
    <h3>Bienvenidos a CineDev, un espacio creado para los amantes del cine y la experiencia audiovisual. Somos
      m√°s que una cartelera: somos una comunidad dedicada a acercarte las mejores pel√≠culas, estrenos, cl√°sicos
      y contenido exclusivo, combinando la pasi√≥n por el s√©ptimo arte con una plataforma moderna, din√°mica y
      f√°cil de usar.</h3>
    <h3 class="mt-3">
      En CineDev trabajamos para que cada visita sea simple, c√≥moda y emocionante. Nuestro objetivo es ofrecerte
      una experiencia completa: desde descubrir nuevas pel√≠culas hasta disfrutar de funciones especiales,
      promociones y toda la informaci√≥n que necesit√°s para elegir tu pr√≥xima historia favorita.</h3>

    Creemos en el cine como un puente entre personas, emociones y mundos distintos. Por eso desarrollamos una
    plataforma pensada con detalle, con tecnolog√≠a actual, dise√±o claro y una navegaci√≥n que se adapta a vos.
    <h3 class="mt-3">
      Porque el cine siempre se vive mejor cuando est√° bien contado‚Ä¶
      Bienvenidos a CineDev, donde cada pel√≠cula encuentra su p√∫blico.</h3>
  </div>
</div>

<script>
  new Swiper(".mySwiper", {
    slidesPerView: 3,
    spaceBetween: 15,
    loop: true,
    autoplay: {
      delay: 2000,
      disableOnInteraction: false,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    breakpoints: {
      0: { slidesPerView: 1 },
      640: { slidesPerView: 2 },
      1024: { slidesPerView: 3 },
      1280: { slidesPerView: 3 },
    },
  });
</script>
</div>
</div>
</div>
</div>

<script>
  new Swiper(".mySwiper", {
    slidesPerView: 3,
    spaceBetween: 15,
    loop: true,
    autoplay: {
      delay: 2000,
      disableOnInteraction: false,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    breakpoints: {
      0: { slidesPerView: 1 },
      640: { slidesPerView: 2 },
      1024: { slidesPerView: 3 },
      1280: { slidesPerView: 3 },
    },
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    async function mostrarPelicula(
      titulo,
      duracion,
      sinopsis,
      director,
      genero,
      id_pelicula,
      imagen
    ) {
      const resp = await fetch(`/api/funciones?pelicula=${id_pelicula}`);
      const funciones = await resp.json();

      if (!Array.isArray(funciones) || funciones.length === 0) {
        Swal.fire("Sin funciones disponibles", "", "warning");
        return;
      }

      function formatearFecha(fechaCompleta) {
        const f = new Date(fechaCompleta);
        return (
          f.getDate() + " " + f.toLocaleString("es-ES", { month: "short" })
        );
      }

      function obtenerDiaClave(fechaCompleta) {
        return new Date(fechaCompleta).toISOString().split("T")[0];
      }

      function formatearHora(fechaCompleta) {
        const f = new Date(fechaCompleta);
        return f.toLocaleTimeString("es-ES", {
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      // AGRUPAR POR FECHA
      const agrupadas = {};
      funciones.forEach((f) => {
        const clave = obtenerDiaClave(f.fecha_hora);
        if (!agrupadas[clave]) agrupadas[clave] = [];
        agrupadas[clave].push(f);
      });

      // BOTONES DE FECHAS
      let fechasHtml = "";
      for (let clave in agrupadas) {
        fechasHtml += `
      <button class="fecha-btn px-4 py-2 bg-gray-700 rounded hover:bg-red-700"
              data-fecha="${clave}">
        ${formatearFecha(agrupadas[clave][0].fecha_hora)}
      </button>`;
      }

      // MOSTRAR POPUP
      Swal.fire({
        width: "80%",
        background: "#111",
        color: "#fff",
        showConfirmButton: false,
        html: `
      <div class="flex flex-col md:flex-row text-left">

        <div class="md:w-1/3">
          <img src="${imagen}" class="img-card w-60 h-96 object-cover rounded-t-2xl shadow-lg">
          <span class="px-3 py-1 bg-gray-700 rounded-full text-sm mt-2 inline-block">${genero}</span>
        </div>

        <div class="md:w-2/3 md:pl-6">
          <h1 class="text-3xl font-bold text-red-600">${titulo}</h1>
          <p class="text-gray-300 mb-4 leading-relaxed">${sinopsis}</p>
         
          <h2 class="text-xl font-semibold mb-2">Eleg√≠ una fecha:</h2>

          <div id="contenedor-fechas" class="flex flex-wrap gap-3 mb-6">
            ${fechasHtml}
          </div>
          
          <div id="contenedor-horarios"></div>
        </div>

      </div>
    `,
      });

      // **DELEGACI√ìN DE EVENTOS DENTRO DEL SWEETALERT**
      document.addEventListener("click", function listener(e) {
        // CLIC EN FECHA
        if (e.target.classList.contains("fecha-btn")) {
          const clave = e.target.dataset.fecha;
          const lista = agrupadas[clave];

          let horariosHtml = `
      <h3 class="text-xl font-semibold mb-2">Horarios disponibles:</h3>
      <div class="flex flex-wrap gap-3">
      `;

          lista.forEach((f) => {
            horariosHtml += `
          <button class="hora-btn px-4 py-2 bg-gray-700 rounded hover:bg-red-700"
                  data-id="${f.id_funcion}">
            ${formatearHora(f.fecha_hora)} ¬∑ Sala ${f.id_sala}
          </button>`;
          });

          horariosHtml += "</div>";

          document.querySelector("#contenedor-horarios").innerHTML =
            horariosHtml;
        }

        // CLIC EN HORARIO
        if (e.target.classList.contains("hora-btn")) {
          const idFuncion = e.target.dataset.id;
          window.location.href = `/butacas?pelicula=${id_pelicula}&funcion=${idFuncion}`;
        }
      });
    }

    // CLICK EN CADA TARJETA
    document.querySelectorAll(".pelicula-cartelera").forEach((card) => {
      card.addEventListener("click", () => {
        mostrarPelicula(
          card.dataset.titulo,
          card.dataset.duracion,
          card.dataset.sinopsis,
          card.dataset.director,
          card.dataset.genero,
          card.dataset.id,
          card.dataset.img
        );
      });
    });
  </script>
  <script>
document.getElementById("filtroGenero").addEventListener("change", function () {
    const generoSeleccionado = this.value.toLowerCase();
    const peliculas = document.querySelectorAll(".card-pelicula");

    peliculas.forEach(card => {
        const generoCard = card.dataset.genero.toLowerCase();

        if (generoSeleccionado === "todos" || generoCard === generoSeleccionado) {
            card.style.display = "block";
        } else {
            card.style.display = "none";
        }
    });
});
</script>
{% endblock %}